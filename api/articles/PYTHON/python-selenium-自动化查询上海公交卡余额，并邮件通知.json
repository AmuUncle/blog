{"title":"python selenium 自动化查询上海公交卡余额，并邮件通知","uid":"bc39cd2103ce29a3cc74ae96baf8383f","slug":"PYTHON/python-selenium-自动化查询上海公交卡余额，并邮件通知","date":"2017-10-28T16:49:43.000Z","updated":"2023-05-19T05:34:20.567Z","comments":true,"path":"api/articles/PYTHON/python-selenium-自动化查询上海公交卡余额，并邮件通知.json","keywords":null,"cover":[],"content":"<h1 id=\"python-selenium-自动化查询上海公交卡余额，并邮件通知\"><a href=\"#python-selenium-自动化查询上海公交卡余额，并邮件通知\" class=\"headerlink\" title=\"python selenium 自动化查询上海公交卡余额，并邮件通知\"></a>python selenium 自动化查询上海公交卡余额，并邮件通知</h1><p>1、下载python安装。<br>　　<a href=\"https://www.python.org/downloads/release/python-351/\">https://www.python.org/downloads/release/python-351/</a><br>2、安装selenium<br>2.1、通过pip 安装<br>    pip install selenium</p>\n<p>2.2、通过下载包安装 ,直接下载selenium包：<br>    <a href=\"https://pypi.python.org/pypi/selenium\">https://pypi.python.org/pypi/selenium</a><br>    解压，cmd进入目录:<br>         python setup.py install</p>\n<p>3 、 安装Chrome driver<br>    下载地址：<a href=\"http://npm.taobao.org/mirrors/chromedriver\">http://npm.taobao.org/mirrors/chromedriver</a><br>    下载解压，将 chromedriver.exe 文件放到chrome的安装目录下…\\Google\\Chrome\\Application\\ ,然后设置path环境变量；<br>    <img src=\"http://img.blog.csdn.net/20171016220018549?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"chromedriver与chrome各版本对应表\"></p>\n<p>4、全部代码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">\t# coding = utf-8</span><br><span class=\"line\"></span><br><span class=\"line\">from selenium import webdriver</span><br><span class=\"line\">from time import sleep</span><br><span class=\"line\">import smtplib</span><br><span class=\"line\">import traceback</span><br><span class=\"line\">from email.mime.text import MIMEText</span><br><span class=\"line\">from email.mime.multipart import MIMEMultipart</span><br><span class=\"line\">cardIDList = [u&quot;u54311******&quot;, u&quot;u728833******&quot;]</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">def sendmail(subject,msg,toaddrs,fromaddr,smtpaddr,password):</span><br><span class=\"line\">    &#x27;&#x27;&#x27;</span><br><span class=\"line\">    @subject:邮件主题</span><br><span class=\"line\">    @msg:邮件内容</span><br><span class=\"line\">    @toaddrs:收信人的邮箱地址</span><br><span class=\"line\">    @fromaddr:发信人的邮箱地址</span><br><span class=\"line\">    @smtpaddr:smtp服务地址，可以在邮箱看，比如163邮箱为smtp.163.com</span><br><span class=\"line\">    @password:发信人的邮箱密码</span><br><span class=\"line\">    &#x27;&#x27;&#x27;</span><br><span class=\"line\">    mail_msg = MIMEMultipart()</span><br><span class=\"line\">    mail_msg[&#x27;Subject&#x27;] = subject</span><br><span class=\"line\">    mail_msg[&#x27;From&#x27;] =fromaddr</span><br><span class=\"line\">    mail_msg[&#x27;To&#x27;] = &#x27;,&#x27;.join(toaddrs)</span><br><span class=\"line\">    mail_msg.attach(MIMEText(msg, &#x27;html&#x27;, &#x27;utf-8&#x27;))</span><br><span class=\"line\">    try:</span><br><span class=\"line\">        s = smtplib.SMTP()</span><br><span class=\"line\">        s.connect(smtpaddr)  #连接smtp服务器</span><br><span class=\"line\">        s.login(fromaddr,password)  #登录邮箱</span><br><span class=\"line\">        s.sendmail(fromaddr, toaddrs, mail_msg.as_string()) #发送邮件</span><br><span class=\"line\">        s.quit()</span><br><span class=\"line\">    except :</span><br><span class=\"line\">       print (&quot;Error: unable to send email&quot;)</span><br><span class=\"line\">       print (traceback.format_exc())</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">def get_gj_info(cardID):</span><br><span class=\"line\">    for i in range(1, 10, 1):</span><br><span class=\"line\">        try:</span><br><span class=\"line\">            print(&quot;第%d次尝试。。。。&quot; % i)</span><br><span class=\"line\">            driver = webdriver.Chrome()</span><br><span class=\"line\">            print(&quot;###########&gt;&gt;&gt;&gt;&gt;&gt;&gt;开始打开上海交通网站&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;#########&quot;)</span><br><span class=\"line\">            driver.get(&#x27;http://www.sptcc.com/&#x27;)</span><br><span class=\"line\">            print(driver.title)</span><br><span class=\"line\">            print(&quot;网站打开成功&quot;)</span><br><span class=\"line\">            sleep(2)</span><br><span class=\"line\">            print(&quot;查询公交卡号:%s&quot; % cardID)</span><br><span class=\"line\">            driver.find_element_by_id(&quot;pL1i1&quot;).send_keys(cardID)</span><br><span class=\"line\">            driver.find_element_by_css_selector(&quot;a[class=\\&quot;pL1b1\\&quot;]&quot;).click()</span><br><span class=\"line\">            sleep(2)</span><br><span class=\"line\">            data = driver.find_element_by_css_selector(&quot;p[class=\\&quot;amt\\&quot;]&quot;).text</span><br><span class=\"line\">            print(&quot;公交卡 &#123;0&#125;  &#123;1&#125; &quot;.format(cardID, data))</span><br><span class=\"line\">            driver.quit()</span><br><span class=\"line\">            return &quot;公交卡 &#123;0&#125;  &#123;1&#125; \\n&quot;.format(cardID, data)</span><br><span class=\"line\">            break</span><br><span class=\"line\">        except:</span><br><span class=\"line\">            print(&quot;查询出错。。。，再次尝试。。。&quot;)</span><br><span class=\"line\"></span><br><span class=\"line\">    print(&quot;##################&gt;&gt;&gt;&gt;&gt;&gt;&gt;退出查询&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;##############&quot;)</span><br><span class=\"line\">    return &quot;查询出错。。。&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">if __name__ == &#x27;__main__&#x27;:</span><br><span class=\"line\">    fromaddr = &quot;*******@163.com&quot;</span><br><span class=\"line\">    smtpaddr = &quot;smtp.163.com&quot;          # 163邮件smtp服务器地址</span><br><span class=\"line\">    toaddrs = [&quot;*******@qq.com&quot;, &quot;*******@163.com&quot;]</span><br><span class=\"line\">    gj_info =&#x27;&#x27;</span><br><span class=\"line\">    for cardID in cardIDList:</span><br><span class=\"line\">        gj_info += get_gj_info(cardID)</span><br><span class=\"line\">    subject = gj_info</span><br><span class=\"line\">    password = &quot;*******&quot;</span><br><span class=\"line\">    msg = gj_info</span><br><span class=\"line\">    sendmail(subject,msg,toaddrs,fromaddr,smtpaddr,password)</span><br></pre></td></tr></table></figure>\n\n\n\n\n\n\n","text":"python selenium 自动化查询上海公交卡余额，并邮件通知1、下载python安装。 https://www.python.org/downloads...","permalink":"/post/PYTHON/python-selenium-自动化查询上海公交卡余额，并邮件通知","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"PYTHON实战","slug":"PYTHON实战","count":1,"path":"api/categories/PYTHON实战.json"}],"tags":[{"name":"PYTHON","slug":"PYTHON","count":1,"path":"api/tags/PYTHON.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#python-selenium-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9F%A5%E8%AF%A2%E4%B8%8A%E6%B5%B7%E5%85%AC%E4%BA%A4%E5%8D%A1%E4%BD%99%E9%A2%9D%EF%BC%8C%E5%B9%B6%E9%82%AE%E4%BB%B6%E9%80%9A%E7%9F%A5\"><span class=\"toc-text\">python selenium 自动化查询上海公交卡余额，并邮件通知</span></a></li></ol>","author":{"name":"阿木大叔","slug":"blog-author","avatar":"/images/base/logo.png","link":"/","description":"坚持code，努力吹牛 <br /> @ <b>gitee：阿木大叔</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"工具使用--第2节 HEXO+GitHub 搭建个人博客","uid":"05174ca29f2b54bcb09b1b16597992ea","slug":"WEB/工具使用-第2节-HEXO-GitHub-搭建个人博客","date":"2017-10-29T06:10:26.000Z","updated":"2023-05-19T05:34:20.887Z","comments":true,"path":"api/articles/WEB/工具使用-第2节-HEXO-GitHub-搭建个人博客.json","keywords":null,"cover":[],"text":"今天突然想搭建一个自己的私人博客，但是又不想为此买一台服务器，所以百度了一下，发现可以利用**HEXO+码云 **搭建私人博客，所以就写篇教程，记录一下吧。 1...","permalink":"/post/WEB/工具使用-第2节-HEXO-GitHub-搭建个人博客","photos":[],"count_time":{"symbolsCount":"3k","symbolsTime":"3 mins."},"categories":[{"name":"GitHub","slug":"GitHub","count":1,"path":"api/categories/GitHub.json"}],"tags":[{"name":"HEXO","slug":"HEXO","count":1,"path":"api/tags/HEXO.json"}],"author":{"name":"阿木大叔","slug":"blog-author","avatar":"/images/base/logo.png","link":"/","description":"坚持code，努力吹牛 <br /> @ <b>gitee：阿木大叔</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"工具使用--第1节 git使用简记","uid":"1af68f9dfe3c7e2933ac93e37e9817a4","slug":"WEB/工具使用-第1节-git使用简记","date":"2017-10-28T15:38:48.000Z","updated":"2023-05-19T05:34:20.886Z","comments":true,"path":"api/articles/WEB/工具使用-第1节-git使用简记.json","keywords":null,"cover":[],"text":"工具使用–第1节 git使用简记GIT （分布式版本控制系统） Git是一款免费、开源的分布式版本控制系统，用于敏捷高效地处理任何或小或大的项目。 Git的读音...","permalink":"/post/WEB/工具使用-第1节-git使用简记","photos":[],"count_time":{"symbolsCount":"1.4k","symbolsTime":"1 mins."},"categories":[{"name":"git教程","slug":"git教程","count":1,"path":"api/categories/git教程.json"}],"tags":[{"name":"GIT","slug":"GIT","count":1,"path":"api/tags/GIT.json"}],"author":{"name":"阿木大叔","slug":"blog-author","avatar":"/images/base/logo.png","link":"/","description":"坚持code，努力吹牛 <br /> @ <b>gitee：阿木大叔</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}