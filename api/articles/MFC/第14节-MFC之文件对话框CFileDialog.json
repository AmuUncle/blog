{"title":"第14节 MFC之文件对话框CFileDialog","uid":"236b306ed30598f9de558dada84c87a9","slug":"MFC/第14节-MFC之文件对话框CFileDialog","date":"2017-11-01T13:49:20.000Z","updated":"2023-05-19T05:34:20.889Z","comments":true,"path":"api/articles/MFC/第14节-MFC之文件对话框CFileDialog.json","keywords":null,"cover":[],"content":"<h1 id=\"第14节-MFC之文件对话框CFileDialog\"><a href=\"#第14节-MFC之文件对话框CFileDialog\" class=\"headerlink\" title=\"第14节 MFC之文件对话框CFileDialog\"></a>第14节 MFC之文件对话框CFileDialog</h1><hr>\n<p>今天我们学习两个打开文件对话框、保存文件对话框，应用程序难免需要加载文件，或者打开配置文件等，这就用到打开或者保存对话框，例如windows文本编辑器中保存对话框就属于其中一种：<br><img src=\"http://img.blog.csdn.net/20171101203217131?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"></p>\n<hr>\n<h2 id=\"1-新建项目\"><a href=\"#1-新建项目\" class=\"headerlink\" title=\"1. 新建项目\"></a>1. 新建项目</h2><p>新建一个基于对话框项目“day16”，布局如下，自行处理：<br><img src=\"http://img.blog.csdn.net/20171101203650950?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"><br>拖动一个EDIT到界面，并修改如下属性：</p>\n<table>\n<thead>\n<tr>\n<th>属性</th>\n<th>修改值</th>\n<th>解释</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>ID</td>\n<td>IDC_EDIT_TXT</td>\n<td>控件ID</td>\n</tr>\n<tr>\n<td>Want Return</td>\n<td>TRUE</td>\n<td>允许回车</td>\n</tr>\n<tr>\n<td>Multiline</td>\n<td>TRUE</td>\n<td>允许多行</td>\n</tr>\n<tr>\n<td>Horizontal Scoll</td>\n<td>TRUE</td>\n<td>水平滚动条</td>\n</tr>\n<tr>\n<td>Vertical Scoll</td>\n<td>TRUE</td>\n<td>垂直滚动条</td>\n</tr>\n</tbody></table>\n<h2 id=\"2-添加菜单资源\"><a href=\"#2-添加菜单资源\" class=\"headerlink\" title=\"2. 添加菜单资源\"></a>2. 添加菜单资源</h2><p>切换到资源视图，添加菜单资源如下：<br><img src=\"http://img.blog.csdn.net/20171101204453007?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"><br>若不知道怎么添加菜单请参考<a href=\"http://blog.csdn.net/qq_25549309/article/details/78359647\">**Windows编程基础–第10节 MFC菜单 **</a></p>\n<blockquote>\n<p>注意：菜单选项最后加上&amp;符号可以设置快捷键，如“文件(&amp;F)”，当程序运行时可以通过ALT + F快捷打开文件菜单选项；</p>\n</blockquote>\n<p>将菜单绑定到主界面：<br><img src=\"http://img.blog.csdn.net/20171101204853878?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"></p>\n<h2 id=\"3-实现文件打开对话框\"><a href=\"#3-实现文件打开对话框\" class=\"headerlink\" title=\"3. 实现文件打开对话框\"></a>3. 实现文件打开对话框</h2><p>右击菜单中“打开”选项，选择“添加事件处理处理程序”，添加处理程序，如图：<br><img src=\"http://img.blog.csdn.net/20171101205350070?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\">其中行数处理程序名称：OnFileOpen，类列表选择：Cday16Dlg，添加编辑：<br>函数代码如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void Cday16Dlg::OnFileOpen()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加命令处理程序代码</span><br><span class=\"line\">\tCFileDialog dlg(TRUE,NULL,NULL,OFN_FILEMUSTEXIST|OFN_PATHMUSTEXIST,_T(&quot;文本文件(*.txt)|*.txt|所有文件(*.*)|*.*||&quot;),this);</span><br><span class=\"line\">\tdlg.m_ofn.lpstrInitialDir = _T(&quot;C:\\\\&quot;);</span><br><span class=\"line\">\tif (dlg.DoModal()  == IDOK)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCStdioFile inFile;</span><br><span class=\"line\">\t\tinFile.Open(dlg.GetPathName(),CFile::modeRead);</span><br><span class=\"line\">\t\tCString text;</span><br><span class=\"line\">\t\tCString temp;</span><br><span class=\"line\">\t\twhile(inFile.ReadString(text))</span><br><span class=\"line\">\t\t&#123;    </span><br><span class=\"line\">\t\t\tGetDlgItemText(IDC_EDIT_TXT,temp);</span><br><span class=\"line\">\t\t\tif (temp.GetLength() &gt; 0)</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tSetDlgItemText(IDC_EDIT_TXT,temp +&quot;\\r\\n&quot;+ text);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\telse</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tSetDlgItemText(IDC_EDIT_TXT,text);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\t</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">\t\tinFile.Close();</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>代码解释：</p>\n<blockquote>\n<ol>\n<li>创建一个txt文件对话框；</li>\n<li>如文件对话框确定按钮被点击，则打开文件位置，文件全路径就是dlg.GetPathName()；</li>\n<li>循环读取文件，知道文件读取结束；每读一行就先获取界面文本框的内容加上新读取的文本，重新设置到界面；</li>\n<li>关闭文件</li>\n</ol>\n</blockquote>\n<p>这样一个打开文件对话框就完成了，效果图如下：<br><img src=\"http://img.blog.csdn.net/20171101213305582?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"></p>\n<h2 id=\"3-实现文件保存对话框\"><a href=\"#3-实现文件保存对话框\" class=\"headerlink\" title=\"3. 实现文件保存对话框\"></a>3. 实现文件保存对话框</h2><p>右击菜单中“保存”选项，选择“添加事件处理处理程序”，添加处理程序，如图：<br><img src=\"http://img.blog.csdn.net/20171101213433187?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"><br>名称：OnSaveFile，类列表选择：Cday16Dlg，添加编辑：<br>函数代码如下</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">void Cday16Dlg::OnSaveFile()</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\t// TODO: 在此添加命令处理程序代码</span><br><span class=\"line\">\tCFileDialog dlg(FALSE,NULL,NULL,OFN_HIDEREADONLY |OFN_OVERWRITEPROMPT | OFN_PATHMUSTEXIST,_T(&quot;文本文件(*.txt)|*.txt||&quot;),this);</span><br><span class=\"line\">\tif (dlg.DoModal()  == IDOK)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tCFile file;  //建立一个CFile对象</span><br><span class=\"line\">\t\t//打开文件,如果不存在该文件就创建文件</span><br><span class=\"line\">\t\tif(!file.Open(dlg.GetPathName(),CFile::modeCreate|CFile::modeWrite))</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\tAfxMessageBox( &quot;can   not   Create   file! &quot;);</span><br><span class=\"line\">\t\t\treturn;</span><br><span class=\"line\">\t\t&#125; </span><br><span class=\"line\"></span><br><span class=\"line\">\t\tCString output;</span><br><span class=\"line\">\t\tGetDlgItemText(IDC_EDIT_TXT,output);</span><br><span class=\"line\">\t\tfile.Write(output,strlen(output));</span><br><span class=\"line\">\t\tfile.Flush();    //将在缓冲区中的字符写入文件中</span><br><span class=\"line\">\t\tfile.Close();   //关闭文件</span><br><span class=\"line\">\t\tAfxMessageBox( &quot;保存成功！&quot;);</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>代码解释：</p>\n<blockquote>\n<ol>\n<li>创建一个txt文件保存对话框；</li>\n<li>如文件对话框确定按钮被点击，则获取文件位置，文件全路径就是dlg.GetPathName()；</li>\n<li>先获取界面文本框的内容，将内容写到文件中；</li>\n<li>关闭文件<br>效果图：<br><img src=\"http://img.blog.csdn.net/20171101214549676?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"></li>\n</ol>\n</blockquote>\n<h2 id=\"好了，这节我们演示了如何创建文件打开和保存对话框，希望对大家有作用，今天就到这了。\"><a href=\"#好了，这节我们演示了如何创建文件打开和保存对话框，希望对大家有作用，今天就到这了。\" class=\"headerlink\" title=\"好了，这节我们演示了如何创建文件打开和保存对话框，希望对大家有作用，今天就到这了。\"></a>好了，这节我们演示了如何创建文件打开和保存对话框，希望对大家有作用，今天就到这了。</h2><h3 id=\"项目源码可以访问我的码云\"><a href=\"#项目源码可以访问我的码云\" class=\"headerlink\" title=\"项目源码可以访问我的码云\"></a><a href=\"https://gitee.com/AmuUncle/MFC_CSDN.git\">项目源码可以访问我的码云</a></h3><h3 id=\"我的私人博客\"><a href=\"#我的私人博客\" class=\"headerlink\" title=\"&gt;&gt;&gt;我的私人博客&lt;&lt;&lt;\"></a><a href=\"http://blog.amuuncle.site/\">&gt;&gt;&gt;我的私人博客&lt;&lt;&lt;</a></h3>","text":"第14节 MFC之文件对话框CFileDialog 今天我们学习两个打开文件对话框、保存文件对话框，应用程序难免需要加载文件，或者打开配置文件等，这就用到打开或...","permalink":"/post/MFC/第14节-MFC之文件对话框CFileDialog","photos":[],"count_time":{"symbolsCount":"2.4k","symbolsTime":"2 mins."},"categories":[{"name":"MFC从入门到放弃","slug":"MFC从入门到放弃","count":15,"path":"api/categories/MFC从入门到放弃.json"}],"tags":[{"name":"MFC","slug":"MFC","count":15,"path":"api/tags/MFC.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#%E7%AC%AC14%E8%8A%82-MFC%E4%B9%8B%E6%96%87%E4%BB%B6%E5%AF%B9%E8%AF%9D%E6%A1%86CFileDialog\"><span class=\"toc-text\">第14节 MFC之文件对话框CFileDialog</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#1-%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE\"><span class=\"toc-text\">1. 新建项目</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#2-%E6%B7%BB%E5%8A%A0%E8%8F%9C%E5%8D%95%E8%B5%84%E6%BA%90\"><span class=\"toc-text\">2. 添加菜单资源</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E5%AF%B9%E8%AF%9D%E6%A1%86\"><span class=\"toc-text\">3. 实现文件打开对话框</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#3-%E5%AE%9E%E7%8E%B0%E6%96%87%E4%BB%B6%E4%BF%9D%E5%AD%98%E5%AF%B9%E8%AF%9D%E6%A1%86\"><span class=\"toc-text\">3. 实现文件保存对话框</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A5%BD%E4%BA%86%EF%BC%8C%E8%BF%99%E8%8A%82%E6%88%91%E4%BB%AC%E6%BC%94%E7%A4%BA%E4%BA%86%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E6%89%93%E5%BC%80%E5%92%8C%E4%BF%9D%E5%AD%98%E5%AF%B9%E8%AF%9D%E6%A1%86%EF%BC%8C%E5%B8%8C%E6%9C%9B%E5%AF%B9%E5%A4%A7%E5%AE%B6%E6%9C%89%E4%BD%9C%E7%94%A8%EF%BC%8C%E4%BB%8A%E5%A4%A9%E5%B0%B1%E5%88%B0%E8%BF%99%E4%BA%86%E3%80%82\"><span class=\"toc-text\">好了，这节我们演示了如何创建文件打开和保存对话框，希望对大家有作用，今天就到这了。</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E9%A1%B9%E7%9B%AE%E6%BA%90%E7%A0%81%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E6%88%91%E7%9A%84%E7%A0%81%E4%BA%91\"><span class=\"toc-text\">项目源码可以访问我的码云</span></a></li><li class=\"toc-item toc-level-3\"><a class=\"toc-link\" href=\"#%E6%88%91%E7%9A%84%E7%A7%81%E4%BA%BA%E5%8D%9A%E5%AE%A2\"><span class=\"toc-text\">&gt;&gt;&gt;我的私人博客&lt;&lt;&lt;</span></a></li></ol></li></ol></li></ol>","author":{"name":"阿木大叔","slug":"blog-author","avatar":"/images/base/logo.png","link":"/","description":"坚持code，努力吹牛 <br /> @ <b>gitee：阿木大叔</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"第15节 MFC之复选框及单选按钮","uid":"4cba1917e258f58a831088a0ecbb4f93","slug":"MFC/第15节-MFC之复选框及单选按钮","date":"2017-11-02T15:00:09.000Z","updated":"2023-05-19T05:34:20.889Z","comments":true,"path":"api/articles/MFC/第15节-MFC之复选框及单选按钮.json","keywords":null,"cover":[],"text":"Windows编程基础–第15节 MFC之复选框及单选按钮1. 新建项目新建一个基于对话框项目“day17”，布局如下，自行处理： 拖动三个check box和...","permalink":"/post/MFC/第15节-MFC之复选框及单选按钮","photos":[],"count_time":{"symbolsCount":"2k","symbolsTime":"2 mins."},"categories":[{"name":"MFC从入门到放弃","slug":"MFC从入门到放弃","count":15,"path":"api/categories/MFC从入门到放弃.json"}],"tags":[{"name":"MFC","slug":"MFC","count":15,"path":"api/tags/MFC.json"}],"author":{"name":"阿木大叔","slug":"blog-author","avatar":"/images/base/logo.png","link":"/","description":"坚持code，努力吹牛 <br /> @ <b>gitee：阿木大叔</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"第13节 MFC之图片控件","uid":"33b07364cfa133acbebe1120a6b4e2ef","slug":"MFC/第13节-MFC之图片控件","date":"2017-10-31T14:37:27.000Z","updated":"2023-05-19T05:34:20.889Z","comments":true,"path":"api/articles/MFC/第13节-MFC之图片控件.json","keywords":null,"cover":[],"text":"第13节 MFC之图片控件这节学习两个控件： 图片控件： Picture Control 1. 新建项目新建一个基于对话框项目“day15”，布局如下，自行处理...","permalink":"/post/MFC/第13节-MFC之图片控件","photos":[],"count_time":{"symbolsCount":"2.2k","symbolsTime":"2 mins."},"categories":[{"name":"MFC从入门到放弃","slug":"MFC从入门到放弃","count":15,"path":"api/categories/MFC从入门到放弃.json"}],"tags":[{"name":"MFC","slug":"MFC","count":15,"path":"api/tags/MFC.json"}],"author":{"name":"阿木大叔","slug":"blog-author","avatar":"/images/base/logo.png","link":"/","description":"坚持code，努力吹牛 <br /> @ <b>gitee：阿木大叔</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}