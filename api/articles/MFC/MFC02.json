{"title":"Windows编程基础--第2节 win32程序资源管理","uid":"3f633bfafeec92d57d809cdb658962e5","slug":"MFC/MFC02","date":"2017-10-28T14:55:13.000Z","updated":"2023-05-19T05:34:19.701Z","comments":true,"path":"api/articles/MFC/MFC02.json","keywords":null,"cover":[],"content":"<h1 id=\"Windows编程基础–第2节-win32程序资源管理\"><a href=\"#Windows编程基础–第2节-win32程序资源管理\" class=\"headerlink\" title=\"Windows编程基础–第2节 win32程序资源管理\"></a>Windows编程基础–第2节 win32程序资源管理</h1><p>（操作系统：win10 64位 IDE：vc++ 6.0）<br>windows程序都有自己的资源，例如按钮，图标，对话框等等，这节介绍如何使用win32程序资源管理；<br>1、继续使用上节的win32程序demo，执行File-&gt;new添加资源，选择Files选项卡中的Resource Script，填写资源名，如图所示：<br><img src=\"http://img.blog.csdn.net/20171018195816455?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"><br>2、此时项目左侧会出现ResourceView视图，单击ResourceView中的根节点+号，会提示“This file is already open in an editor”，这时候关闭右边的day01.rc，再次打开就可以了；<br><img src=\"http://img.blog.csdn.net/20171018200304399?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"><br>3、在ResourceView节点day01 Resources节点上右击-&gt;Insert,选中Dialog<br>,单击“New”,创建一个对话框资源，创建成功之后如图：<br><img src=\"http://img.blog.csdn.net/20171018200805292?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"><br>4、在新建的对话框上右击选择属性（Properties），会弹出dialog的属性窗口，可以设置一些对话框的相关属性，如图<br><img src=\"http://img.blog.csdn.net/20171018201154122?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"><br>5、接下来我们做一个简单的BMI计算器(体重指数BMI&#x3D;体重&#x2F;身高的平方（国际单位kg&#x2F;㎡）)，拖动三个Edit分别用来显示身高，体重，BMI值，并设置属性ID，分别为：IDC_EDIT_SG、IDC_EDIT_TZ,IDC_EDIT_BMI，如图所示：<br><img src=\"http://img.blog.csdn.net/20171018204956574?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"><br>6、接下来切换到类视图（classView），双击WinMain入口函数，添加对话框语句：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">DialogBox(hInstance,(LPCTSTR)IDD_DIALOG_BMI,NULL,DlGFUNC);</span><br></pre></td></tr></table></figure>\n<p>其中IDD_DIALOG_BMI为刚才添加的对话框属性ID，DlGFUNC为对话框的消息处理函数，<br>7、接下来我们添加DlGFUNC函数，如下：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BOOL CALLBACK DlGFUNC(HWND hwnd_dlg,UINT uMsg,WPARAM wParam,LPARAM lParam)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tswitch(uMsg)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\tcase WM_COMMAND:</span><br><span class=\"line\">\t\tswitch(wParam)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\tcase IDCANCEL:</span><br><span class=\"line\">\t\t\tEndDialog(hwnd_dlg,IDCANCEL);</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\tcase IDOK:</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tint nHeight= GetDlgItemInt(hwnd_dlg,IDC_EDIT_SG,NULL,TRUE);</span><br><span class=\"line\">\t\t\t\tdouble dHeight = nHeight / 100.00;</span><br><span class=\"line\">\t\t\t\tint nWeight = GetDlgItemInt(hwnd_dlg,IDC_EDIT_TZ,NULL,TRUE);</span><br><span class=\"line\">\t\t\t\tdouble bmi = nWeight/(dHeight*dHeight);</span><br><span class=\"line\">\t\t\t\tchar buf[28];</span><br><span class=\"line\">\t\t\t\tsprintf(buf, &quot;%.3f&quot;, bmi);</span><br><span class=\"line\">\t\t\t\tSetDlgItemText(hwnd_dlg,IDC_EDIT_BMI,buf);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn FALSE;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中IDOK，和IDCANCEL为对话框确认按钮和取消按钮所触发消息，IDCANCEL关闭对话框，IDOK消息我们来获取身高和体重Edit中的值，并按照公式体重指数BMI&#x3D;体重&#x2F;身高的平方（国际单位kg&#x2F;㎡）计算BMI,最后将BMI值设置到BMI  Edit中：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">int nHeight= GetDlgItemInt(hwnd_dlg,IDC_EDIT_SG,NULL,TRUE);</span><br><span class=\"line\">double dHeight = nHeight / 100.00;</span><br><span class=\"line\">int nWeight = GetDlgItemInt(hwnd_dlg,IDC_EDIT_TZ,NULL,TRUE);</span><br><span class=\"line\">double bmi = nWeight/(dHeight*dHeight);</span><br><span class=\"line\">char buf[28];</span><br><span class=\"line\">sprintf(buf, &quot;%.3f&quot;, bmi);</span><br><span class=\"line\">SetDlgItemText(hwnd_dlg,IDC_EDIT_BMI,buf);</span><br></pre></td></tr></table></figure>\n<p>注意：要在文件头部引用资源头文件：#include “resource.h”<br>最终效果如下：<br><img src=\"http://img.blog.csdn.net/20171018210021527?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvcXFfMjU1NDkzMDk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast\" alt=\"这里写图片描述\"><br>附day01.cpp源码：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// day01.cpp : Defines the entry point for the application.</span><br><span class=\"line\">//</span><br><span class=\"line\"></span><br><span class=\"line\">#include &quot;stdafx.h&quot;</span><br><span class=\"line\">#include &quot;resource.h&quot;</span><br><span class=\"line\">#include &quot;stdio.h&quot;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">BOOL CALLBACK DlGFUNC(HWND hwnd_dlg,UINT uMsg,WPARAM wParam,LPARAM lParam)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">\tswitch(uMsg)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\tcase WM_COMMAND:</span><br><span class=\"line\">\t\tswitch(wParam)</span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\tcase IDCANCEL:</span><br><span class=\"line\">\t\t\tEndDialog(hwnd_dlg,IDCANCEL);</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\tcase IDOK:</span><br><span class=\"line\">\t\t\t&#123;</span><br><span class=\"line\">\t\t\t\tint nHeight= GetDlgItemInt(hwnd_dlg,IDC_EDIT_SG,NULL,TRUE);</span><br><span class=\"line\">\t\t\t\tdouble dHeight = nHeight / 100.00;</span><br><span class=\"line\">\t\t\t\tint nWeight = GetDlgItemInt(hwnd_dlg,IDC_EDIT_TZ,NULL,TRUE);</span><br><span class=\"line\">\t\t\t\tdouble bmi = nWeight/(dHeight*dHeight);</span><br><span class=\"line\">\t\t\t\tchar buf[28];</span><br><span class=\"line\">\t\t\t\tsprintf(buf, &quot;%.3f&quot;, bmi);</span><br><span class=\"line\">\t\t\t\tSetDlgItemText(hwnd_dlg,IDC_EDIT_BMI,buf);</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t\tbreak;</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\tbreak;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\treturn FALSE;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">int APIENTRY WinMain(HINSTANCE hInstance,</span><br><span class=\"line\">                     HINSTANCE hPrevInstance,</span><br><span class=\"line\">                     LPSTR     lpCmdLine,</span><br><span class=\"line\">                     int       nCmdShow)</span><br><span class=\"line\">&#123;</span><br><span class=\"line\"> \t// TODO: Place code here.</span><br><span class=\"line\">\tDialogBox(hInstance,(LPCTSTR)IDD_DIALOG_BMI,NULL,DlGFUNC);</span><br><span class=\"line\"></span><br><span class=\"line\">\treturn 0;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>后记：<br>    DialogProc是一个窗口过程函数。该函数为一个应用程序定义可与DialogBox函数一起使用的回调函数。它处理发送到一个模态的或无模式对话框的消息。DLGPROC类型定义了一个指向此回调函数的指针。DialogProc函数是应用程序定义函数名的一个占位符。<br>函数原型：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BOOL CALLBACK DialogProc(</span><br><span class=\"line\">HWND hwndDlg,</span><br><span class=\"line\">UINT UMsg,</span><br><span class=\"line\">WPARAM wParam,</span><br><span class=\"line\">LPARAM lParam</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure>\n\n<p>hwndDlg<br>指定对话框。<br>uMsg<br>指定消息。<br>wParam<br>指定消息特定的其他信息。<br>Iparam<br>指定消息特定的其他信息。</p>\n<p>项目源码可以访问我的码云来fork：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://gitee.com/AmuUncle/MFC_CSDN.git</span><br></pre></td></tr></table></figure>","text":"Windows编程基础–第2节 win32程序资源管理（操作系统：win10 64位 IDE：vc++ 6.0）windows程序都有自己的资源，例如按钮，图标...","permalink":"/post/MFC/MFC02","photos":[],"count_time":{"symbolsCount":"3.3k","symbolsTime":"3 mins."},"categories":[{"name":"MFC从入门到放弃","slug":"MFC从入门到放弃","count":15,"path":"api/categories/MFC从入门到放弃.json"}],"tags":[{"name":"MFC","slug":"MFC","count":15,"path":"api/tags/MFC.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Windows%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80%E2%80%93%E7%AC%AC2%E8%8A%82-win32%E7%A8%8B%E5%BA%8F%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86\"><span class=\"toc-text\">Windows编程基础–第2节 win32程序资源管理</span></a></li></ol>","author":{"name":"阿木大叔","slug":"blog-author","avatar":"/images/base/logo.png","link":"/","description":"坚持code，努力吹牛 <br /> @ <b>gitee：阿木大叔</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"第3节 初探MFC","uid":"436629cc87cd5604a8123cfb0e89982f","slug":"MFC/第3节-初探MFC","date":"2017-10-28T15:14:58.000Z","updated":"2023-05-19T05:34:20.890Z","comments":true,"path":"api/articles/MFC/第3节-初探MFC.json","keywords":null,"cover":[],"text":"Windows编程基础–第3节 初探MFC 前言 win32程序属于早期windows软件，已经逐渐被淘汰，但它的设计模式和方法大部分都被MFC所继承，并且MF...","permalink":"/post/MFC/第3节-初探MFC","photos":[],"count_time":{"symbolsCount":"8.9k","symbolsTime":"8 mins."},"categories":[{"name":"MFC从入门到放弃","slug":"MFC从入门到放弃","count":15,"path":"api/categories/MFC从入门到放弃.json"}],"tags":[{"name":"MFC","slug":"MFC","count":15,"path":"api/tags/MFC.json"}],"author":{"name":"阿木大叔","slug":"blog-author","avatar":"/images/base/logo.png","link":"/","description":"坚持code，努力吹牛 <br /> @ <b>gitee：阿木大叔</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}},"next_post":{"title":"Windows编程基础--第1节  第一个win32软件","uid":"c9371cf78a705f43f8740427c79cb17f","slug":"MFC/MFC01","date":"2017-10-28T14:42:12.000Z","updated":"2023-05-19T05:34:19.701Z","comments":true,"path":"api/articles/MFC/MFC01.json","keywords":null,"cover":[],"text":"Windows编程基础–第1节 第一个win32软件下面新建一个win32程序，来演示win32程序开发的原理（操作系统：win10 64位 IDE：vc++ ...","permalink":"/post/MFC/MFC01","photos":[],"count_time":{"symbolsCount":"1.7k","symbolsTime":"2 mins."},"categories":[{"name":"MFC从入门到放弃","slug":"MFC从入门到放弃","count":15,"path":"api/categories/MFC从入门到放弃.json"}],"tags":[{"name":"MFC","slug":"MFC","count":15,"path":"api/tags/MFC.json"}],"author":{"name":"阿木大叔","slug":"blog-author","avatar":"/images/base/logo.png","link":"/","description":"坚持code，努力吹牛 <br /> @ <b>gitee：阿木大叔</b>","socials":{"github":"","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}}}}